<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>งานนิทรรศการและนำเสนอผลงานนักเรียน – โรงเรียนสา</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(90deg, #00d2ff 0%, #3a47d5 100%);
            --secondary-gradient: linear-gradient(90deg, #00d2ff 0%, #3a47d5 100%);
            --accent-gradient: linear-gradient(90deg, #00d2ff 0%, #3a47d5 100%);
            --text-dark: #2d3436;
            --text-light: #636e72;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Kanit', sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 2.5rem 1rem;
            text-align: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            width: 120px;
            height: auto;
            margin-bottom: 1rem;
        }

        .header h1 {
            font-size: clamp(1.2rem, 3.5vw, 2rem);
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            color: white;
            font-size: 0.8rem;
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .connection-status.online {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .connection-status.offline {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .connection-status.loading {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        /* Navigation Menu */
        .nav-menu {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .nav-btn {
            padding: 0.8rem 1.5rem;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            border: 2px solid transparent;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Kanit', sans-serif;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            background: rgba(0, 210, 255, 0.1);
            border-color: #00d2ff;
        }

        .nav-btn.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow);
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        /* Section */
        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 3rem 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            scroll-margin-top: 120px;
        }

        .section.hidden {
            display: none;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .section-icon {
            width: 70px;
            height: 70px;
            background: var(--primary-gradient);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: var(--shadow);
        }

        .section-title h2 {
            font-size: clamp(1.3rem, 3vw, 1.8rem);
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .section-title p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        /* Form Styles */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 1rem 1.2rem;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            font-family: 'Kanit', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-control:focus {
            outline: none;
            border-color: #00d2ff;
            box-shadow: 0 0 0 4px rgba(0, 210, 255, 0.1);
            background: white;
        }

        select.form-control {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 20px;
            padding-right: 3rem;
        }

        /* Registration Type Toggle */
        .registration-type-toggle {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            background: rgba(0, 210, 255, 0.05);
            padding: 1rem;
            border-radius: 15px;
        }

        .type-option {
            flex: 1;
            padding: 1rem;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .type-option:hover {
            border-color: #00d2ff;
            transform: translateY(-2px);
        }

        .type-option.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
            box-shadow: var(--shadow);
        }

        .type-option i {
            font-size: 1.5rem;
        }

        /* Team Members Section */
        .team-members-section {
            background: linear-gradient(90deg, rgba(0, 210, 255, 0.05) 0%, rgba(255, 255, 255, 0.9) 100%);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 2px dashed rgba(0, 210, 255, 0.3);
        }

        .team-members-section.hidden {
            display: none;
        }

        .team-member-item {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #00d2ff;
            position: relative;
            transition: all 0.3s ease;
        }

        .team-member-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .member-number {
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .remove-member-btn {
            padding: 0.5rem 1rem;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Kanit', sans-serif;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .remove-member-btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .add-member-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(90deg, rgba(0, 210, 255, 0.1) 0%, rgba(58, 71, 213, 0.1) 100%);
            border: 2px dashed #00d2ff;
            border-radius: 15px;
            cursor: pointer;
            font-family: 'Kanit', sans-serif;
            font-weight: 500;
            color: var(--text-dark);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .add-member-btn:hover {
            background: linear-gradient(90deg, rgba(0, 210, 255, 0.2) 0%, rgba(58, 71, 213, 0.2) 100%);
            border-color: #3a47d5;
        }

        /* File Upload */
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.2rem;
            background: linear-gradient(90deg, rgba(0, 210, 255, 0.1) 0%, rgba(58, 71, 213, 0.1) 100%);
            border: 2px dashed #00d2ff;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            justify-content: center;
        }

        .file-input-label:hover {
            background: linear-gradient(90deg, rgba(0, 210, 255, 0.2) 0%, rgba(58, 71, 213, 0.2) 100%);
            border-color: #3a47d5;
        }

        .file-name {
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-light);
            font-style: italic;
        }

        /* Buttons */
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-family: 'Kanit', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Admin Section */
        .admin-box {
            background: linear-gradient(90deg, rgba(0, 210, 255, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%);
            border-radius: 25px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 2px solid rgba(0, 210, 255, 0.2);
        }

        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }

        /* Results Display */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .result-card {
            background: var(--primary-gradient);
            border-radius: 25px;
            padding: 2rem;
            color: white;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-8px);
        }

        .result-rank {
            display: inline-block;
            padding: 0.6rem 1.2rem;
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-dark);
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .result-name {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .result-school {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .btn-certificate {
            width: 100%;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-dark);
            border: none;
            border-radius: 15px;
            font-family: 'Kanit', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-certificate:hover {
            background: white;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        /* Chart Container */
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-top: 2rem;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        /* Toast Messages */
        .toast-message {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }

        .toast-message.show {
            transform: translateX(0);
        }

        .toast-message.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .toast-message.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .toast-message.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        /* Competition Categories */
        .competition-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .category-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 4px solid;
            border-image: linear-gradient(90deg, #00d2ff 0%, #3a47d5 100%) 1;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-levels {
            list-style: none;
            padding: 0;
        }

        .category-levels li {
            padding: 0.5rem 0;
            color: var(--text-light);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 0.9rem;
        }

        .category-levels li:last-child {
            border-bottom: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .section {
                padding: 2rem 1.5rem;
            }

            .section-header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .nav-menu {
                gap: 0.5rem;
                padding: 1rem 0.5rem;
            }

            .nav-btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }

            .admin-controls {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .competition-categories {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .connection-status {
                position: relative;
                top: auto;
                right: auto;
                display: inline-block;
                margin-bottom: 1rem;
            }

            .registration-type-toggle {
                flex-direction: column;
            }

            div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }

            .chart-container canvas {
                max-height: 250px !important;
            }
        }

        /* Loading overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #00d2ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Registrations Table */
        .registrations-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .registrations-table thead {
            background: var(--primary-gradient);
            color: white;
        }

        .registrations-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .registrations-table td {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
        }

        .registrations-table tbody tr {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .registrations-table tbody tr:hover {
            background: rgba(0, 210, 255, 0.05);
        }

        .registrations-table tbody tr.selected {
            background: rgba(0, 210, 255, 0.1);
            border-left: 4px solid #00d2ff;
        }

        .select-btn {
            padding: 0.5rem 1rem;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Kanit', sans-serif;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .select-btn:hover {
            transform: scale(1.05);
        }

        .badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-primary {
            background: rgba(0, 210, 255, 0.1);
            color: #3a47d5;
        }

        .badge-success {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
        }

        .badge-team {
            background: rgba(155, 89, 182, 0.1);
            color: #8e44ad;
        }

        /* Winners List in Dashboard */
        .winner-item {
            background: white;
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            border-left: 4px solid #00d2ff;
            transition: all 0.3s ease;
        }

        .winner-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .winner-item-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .winner-item-rank {
            font-size: 1.5rem;
        }

        .winner-item-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1rem;
        }

        .winner-item-details {
            font-size: 0.85rem;
            color: var(--text-light);
            padding-left: 2rem;
        }

        .winner-item-details div {
            margin-bottom: 0.2rem;
        }

        /* Responsive Grid */
        @media (max-width: 968px) {
            .chart-container canvas {
                max-height: 250px !important;
            }
            
            div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
        }

        /* Winners Table */
        .competition-results-section {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            padding: 2rem;
            border-left: 5px solid #00d2ff;
        }

        .competition-results-header {
            border-bottom: 2px solid rgba(0, 210, 255, 0.2);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .winners-table-container {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .winners-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .winners-table thead {
            background: var(--primary-gradient);
            color: white;
        }

        .winners-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .winners-table td {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
        }

        .winners-table tbody tr {
            transition: all 0.3s ease;
        }

        .winners-table tbody tr:hover {
            background: rgba(0, 210, 255, 0.05);
        }

        .winners-table tbody tr:last-child td {
            border-bottom: none;
        }

        .btn-download-cert {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Kanit', sans-serif;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            white-space: nowrap;
        }

        .btn-download-cert:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
        }

        .btn-download-cert:active {
            transform: scale(0.98);
        }

        /* Team Members Display in Table */
        .team-members-list {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .team-members-list .member-item {
            padding: 0.2rem 0;
        }

        /* Responsive for Winners Table */
        @media (max-width: 968px) {
            .winners-table {
                font-size: 0.8rem;
            }

            .winners-table th,
            .winners-table td {
                padding: 0.6rem 0.4rem;
            }

            .btn-download-cert {
                padding: 0.4rem 0.6rem;
                font-size: 0.75rem;
            }

            .competition-results-section {
                padding: 1.5rem 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Connection Status -->
    <div class="connection-status offline" id="connectionStatus">
        <i class="fas fa-wifi"></i> กำลังเชื่อมต่อ...
    </div>

    <div class="header">
        <img src="https://img2.pic.in.th/pic/sa1.png" alt="โรงเรียนสา" class="logo">
        <h1>งานนิทรรศการและนำเสนอผลงานนักเรียน</h1>
        <div class="subtitle">"สืบวิชาการ สานวิชาชีพ สู่ทักษะชีวิตด้วยวิถีถิ่นเวียงป้อ"</div>
        <div class="date">วันศุกร์ที่ 13 กุมภาพันธ์ 2569 ณ โรงเรียนสา อำเภอเวียงสา จังหวัดน่าน</div>
    </div>

    <div class="nav-menu">
        <button class="nav-btn active" onclick="showSection('categories')" id="nav-categories">
            <i class="fas fa-list"></i> รายการแข่งขัน
        </button>
        <button class="nav-btn" onclick="showSection('registration')" id="nav-registration">
            <i class="fas fa-edit"></i> ลงทะเบียน
        </button>
        <button class="nav-btn" onclick="showSection('results')" id="nav-results">
            <i class="fas fa-trophy"></i> ผลการแข่งขัน
        </button>
        <button class="nav-btn" onclick="showSection('dashboard')" id="nav-dashboard">
            <i class="fas fa-chart-bar"></i> แดชบอร์ด
        </button>
    </div>

    <div class="container">
        <!-- Competition Categories Section -->
        <div id="categories" class="section">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="section-title">
                    <h2>รายการแข่งขันทักษะทางวิชาการ</h2>
                    <p>กิจกรรมการแข่งขันเพื่อส่งเสริมทักษะและความสามารถของนักเรียน</p>
                </div>
            </div>

            <div class="competition-categories">
                <div class="category-card">
                    <div class="category-title">
                        <i class="fas fa-palette"></i>
                        การแข่งขันวาดภาพระบายสี "วิถีชีวิตถิ่นเวียงป้อ"
                    </div>
                    <ul class="category-levels">
                        <li><i class="fas fa-child"></i> ระดับชั้น ป.1-ป.2 ประเภทสีไม้ (เดี่ยว)</li>
                        <li><i class="fas fa-child"></i> ระดับชั้น ป.3-ป.4 ประเภท สีชอล์ค (เดี่ยว)</li>
                        <li><i class="fas fa-child"></i> ระดับชั้น ป.5-ป.6 ประเภทสีชอล์ค (เดี่ยว)</li>
                        <li><i class="fas fa-user"></i> ระดับชั้น ม.ต้น หุ่นนิ่ง หัวข้อ เครื่องมือเครื่องใช้ในท้องถิ่น (เดี่ยว)</li>
                        <li><i class="fas fa-user-graduate"></i> ระดับชั้น ม.ปลาย หุ่นนิ่ง หัวข้อ เครื่องมือเครื่องใช้ในท้องถิ่น (เดี่ยว)</li>
                    </ul>
                </div>

                <div class="category-card">
                    <div class="category-title">
                        <i class="fas fa-music"></i>
                        การแข่งขันขับร้องเพลงไทยลูกทุ่งคาราโอเกะ
                    </div>
                    <ul class="category-levels">
                        <li><i class="fas fa-child"></i> ระดับประถมศึกษา (เดี่ยว)</li>
                        <li><i class="fas fa-user"></i> ระดับมัธยมศึกษาตอนต้น (เดี่ยว)</li>
                        <li><i class="fas fa-user-graduate"></i> ระดับมัธยมศึกษาตอนปลาย (เดี่ยว)</li>
                    </ul>
                </div>

                <div class="category-card">
                    <div class="category-title">
                        <i class="fas fa-running"></i>
                        การแข่งขันเซปักตะกร้อ
                    </div>
                    <ul class="category-levels">
                        <li><i class="fas fa-users"></i> ระดับประถมศึกษา - ประเภททีมชาย 3 คน (ทีม)</li>
                        <li><i class="fas fa-users"></i> ระดับประถมศึกษา - ประเภททีมหญิง 3 คน (ทีม)</li>
                    </ul>
                </div>

                <div class="category-card">
                    <div class="category-title">
                        <i class="fas fa-baseball-ball"></i>
                        การแข่งขันคริกเก็ต "คริกเก็ตเยาวชนชิงชนะเลิศ"
                    </div>
                    <ul class="category-levels">
                        <li><i class="fas fa-child"></i> ระดับประถมศึกษา - ประเภทผสม (อายุไม่เกิน 12 ปี) (ทีม)</li>
                    </ul>
                </div>

                <div class="category-card">
                    <div class="category-title">
                        <i class="fas fa-volleyball-ball"></i>
                        การแข่งขันทักษะลูกสองมือล่างวอลเลย์บอล
                    </div>
                    <ul class="category-levels">
                        <li><i class="fas fa-child"></i> ระดับประถมศึกษา - ประเภทเดี่ยว ชาย (เดี่ยว)</li>
                        <li><i class="fas fa-child"></i> ระดับประถมศึกษา - ประเภทเดี่ยว หญิง (เดี่ยว)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Registration Section -->
        <div id="registration" class="section hidden">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-pen-fancy"></i>
                </div>
                <div class="section-title">
                    <h2>ลงทะเบียนเข้าร่วมการแข่งขัน</h2>
                    <p>กรอกข้อมูลและอัพโหลดเอกสารเพื่อลงทะเบียนเข้าร่วมการแข่งขัน</p>
                </div>
            </div>

            <form id="registrationForm">
                <!-- Registration Type Toggle -->
                <div class="registration-type-toggle">
                    <div class="type-option active" onclick="setRegistrationType('individual')" id="type-individual">
                        <i class="fas fa-user"></i>
                        <span>แข่งขันเดี่ยว</span>
                    </div>
                    <div class="type-option" onclick="setRegistrationType('team')" id="type-team">
                        <i class="fas fa-users"></i>
                        <span>แข่งขันแบบทีม</span>
                    </div>
                </div>

                <input type="hidden" id="registrationType" value="individual">

                <!-- Individual Section -->
                <div id="individualSection">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-user"></i> ชื่อ-นามสกุล ผู้เข้าแข่งขัน <span style="color: red;">*</span>
                            </label>
                            <input type="text" class="form-control" id="fullName" placeholder="ระบุชื่อ-นามสกุล">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-school"></i> โรงเรียน <span style="color: red;">*</span>
                            </label>
                            <input type="text" class="form-control" id="school" required placeholder="ระบุชื่อโรงเรียน">
                        </div>
                    </div>
                </div>

                <!-- Team Section -->
                <div id="teamSection" class="team-members-section hidden">
                    <h3 style="margin-bottom: 1rem; color: var(--text-dark); display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-users"></i> รายชื่อสมาชิกในทีม
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-flag"></i> ชื่อทีม <span style="color: red;">*</span>
                        </label>
                        <input type="text" class="form-control" id="teamName" placeholder="ระบุชื่อทีม">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-school"></i> โรงเรียน <span style="color: red;">*</span>
                        </label>
                        <input type="text" class="form-control" id="teamSchool" placeholder="ระบุชื่อโรงเรียน">
                    </div>

                    <div id="teamMembersList">
                        <!-- Team members will be added here dynamically -->
                    </div>

                    <button type="button" class="add-member-btn" onclick="addTeamMember()">
                        <i class="fas fa-plus-circle"></i> เพิ่มสมาชิกในทีม
                    </button>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-trophy"></i> ประเภทการแข่งขัน <span style="color: red;">*</span>
                        </label>
                        <select class="form-control" id="competitionType" required>
                            <option value="">-- เลือกประเภทการแข่งขัน --</option>
                            <option value="วาดภาพระบายสี">การแข่งขันวาดภาพระบายสี "วิถีชีวิตถิ่นเวียงป้อ"</option>
                            <option value="ขับร้องเพลงลูกทุ่งคาราโอเกะ">การแข่งขันขับร้องเพลงไทยลูกทุ่งคาราโอเกะ</option>
                            <option value="เซปักตะกร้อ">การแข่งขันเซปักตะกร้อ</option>
                            <option value="คริกเก็ต">การแข่งขันคริกเก็ต</option>
                            <option value="ทักษะลูกสองมือล่างวอลเลย์บอล">การแข่งขันทักษะลูกสองมือล่างวอลเลย์บอล</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-layer-group"></i> ระดับชั้น/ประเภท <span style="color: red;">*</span>
                        </label>
                        <select class="form-control" id="category" required>
                            <option value="">-- เลือกระดับชั้น/ประเภท --</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-phone"></i> เบอร์โทรศัพท์ <span style="color: red;">*</span>
                        </label>
                        <input type="tel" class="form-control" id="phone" required placeholder="0xx-xxx-xxxx">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-envelope"></i> อีเมล
                        </label>
                        <input type="email" class="form-control" id="email" placeholder="example@email.com">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user-tie"></i> ชื่อครูผู้ควบคุม <span style="color: red;">*</span>
                    </label>
                    <input type="text" class="form-control" id="teacher" required placeholder="ระบุชื่อครูผู้ควบคุม">
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-cloud-upload-alt"></i> อัพโหลดไฟล์เอกสาร (PDF, JPG, PNG)
                    </label>
                    <div class="file-input-wrapper">
                        <input type="file" id="fileUpload" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileSelect(event)">
                        <label for="fileUpload" class="file-input-label">
                            <div>
                                <i class="fas fa-cloud-upload-alt"></i>
                                <div>คลิกเพื่อเลือกไฟล์หรือลากไฟล์มาวาง</div>
                                <small style="color: var(--text-light);">รองรับ PDF, JPG, PNG ขนาดไม่เกิน 5MB</small>
                            </div>
                        </label>
                    </div>
                    <div id="fileName" class="file-name"></div>
                </div>

                <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
                    <i class="fas fa-paper-plane"></i> ส่งใบสมัครเข้าร่วมการแข่งขัน
                </button>
            </form>
        </div>

        <!-- Results Section (ยังคงเหมือนเดิม) -->
        <div id="results" class="section hidden">
            <!-- เนื้อหาเหมือนเดิม -->
        </div>

        <!-- Dashboard Section (ยังคงเหมือนเดิม) -->
        <div id="dashboard" class="section hidden">
            <!-- เนื้อหาเหมือนเดิม -->
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script>
// ====================================
// Registration System with Team Support
// โรงเรียนสา - งานนิทรรศการและนำเสนอผลงานนักเรียน
// ====================================

// Configuration
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzFdlUNoAIKg7o_2ZNt0fNuEwmErLfXT7i8qFm80HaQq6q6c3znzoRCS37nhKZPlCwc/exec';
const ADMIN_PASSWORD = 'sa1234';

// Global variables
let registrationsData = [];
let filteredRegistrations = [];
let winnersData = [];
let isSubmitting = false;
let isAdminLoggedIn = false;
let teamMemberCount = 0;

// Competition categories mapping
const competitionCategories = {
    'วาดภาพระบายสี': [
        'ระดับชั้น ป.1-ป.2 ประเภทสีไม้',
        'ระดับชั้น ป.3-ป.4 ประเภท สีชอล์ค',
        'ระดับชั้น ป.5-ป.6 ประเภทสีชอล์ค',
        'ระดับชั้น ม.ต้น หุ่นนิ่ง หัวข้อ เครื่องมือเครื่องใช้ในท้องถิ่น',
        'ระดับชั้น ม.ปลาย หุ่นนิ่ง หัวข้อ เครื่องมือเครื่องใช้ในท้องถิ่น'
    ],
    'ขับร้องเพลงลูกทุ่งคาราโอเกะ': [
        'ระดับประถมศึกษา',
        'ระดับมัธยมศึกษาตอนต้น',
        'ระดับมัธยมศึกษาตอนปลาย'
    ],
    'เซปักตะกร้อ': [
        'ระดับประถมศึกษา - ประเภททีมชาย 3 คน',
        'ระดับประถมศึกษา - ประเภททีมหญิง 3 คน'
    ],
    'คริกเก็ต': [
        'ระดับประถมศึกษา - ประเภทผสม (อายุไม่เกิน 12 ปี)'
    ],
    'ทักษะลูกสองมือล่างวอลเลย์บอล': [
        'ระดับประถมศึกษา - ประเภทเดี่ยว ชาย',
        'ระดับประถมศึกษา - ประเภทเดี่ยว หญิง'
    ]
};

// ====================================
// Registration Type Management
// ====================================

function setRegistrationType(type) {
    const individualBtn = document.getElementById('type-individual');
    const teamBtn = document.getElementById('type-team');
    const individualSection = document.getElementById('individualSection');
    const teamSection = document.getElementById('teamSection');
    const registrationTypeInput = document.getElementById('registrationType');

    if (type === 'individual') {
        individualBtn.classList.add('active');
        teamBtn.classList.remove('active');
        individualSection.style.display = 'block';
        teamSection.classList.add('hidden');
        registrationTypeInput.value = 'individual';
        
        // Set required for individual fields
        document.getElementById('fullName').required = true;
        document.getElementById('school').required = true;
        document.getElementById('teamName').required = false;
        document.getElementById('teamSchool').required = false;
    } else {
        individualBtn.classList.remove('active');
        teamBtn.classList.add('active');
        individualSection.style.display = 'none';
        teamSection.classList.remove('hidden');
        registrationTypeInput.value = 'team';
        
        // Set required for team fields
        document.getElementById('fullName').required = false;
        document.getElementById('school').required = false;
        document.getElementById('teamName').required = true;
        document.getElementById('teamSchool').required = true;
        
        // Add first team member if none exists
        if (teamMemberCount === 0) {
            addTeamMember();
        }
    }
}

// ====================================
// Team Members Management
// ====================================

function addTeamMember() {
    teamMemberCount++;
    const container = document.getElementById('teamMembersList');
    
    const memberDiv = document.createElement('div');
    memberDiv.className = 'team-member-item';
    memberDiv.id = `team-member-${teamMemberCount}`;
    
    memberDiv.innerHTML = `
        <div class="member-header">
            <div class="member-number">
                <i class="fas fa-user-circle"></i>
                สมาชิกคนที่ ${teamMemberCount}
            </div>
            ${teamMemberCount > 1 ? `
                <button type="button" class="remove-member-btn" onclick="removeTeamMember(${teamMemberCount})">
                    <i class="fas fa-trash"></i> ลบ
                </button>
            ` : ''}
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-user"></i> ชื่อ-นามสกุล <span style="color: red;">*</span>
                </label>
                <input type="text" class="form-control team-member-name" 
                       data-member="${teamMemberCount}" 
                       placeholder="ระบุชื่อ-นามสกุล" required>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-id-card"></i> เลขประจำตัวนักเรียน
                </label>
                <input type="text" class="form-control team-member-id" 
                       data-member="${teamMemberCount}" 
                       placeholder="ระบุเลขประจำตัว (ถ้ามี)">
            </div>
        </div>
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-graduation-cap"></i> ระดับชั้น
            </label>
            <input type="text" class="form-control team-member-grade" 
                   data-member="${teamMemberCount}" 
                   placeholder="เช่น ป.6, ม.3">
        </div>
    `;
    
    container.appendChild(memberDiv);
    
    // Scroll to new member
    memberDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    
    showToast(`เพิ่มสมาชิกคนที่ ${teamMemberCount} แล้ว`, 'success');
}

function removeTeamMember(memberId) {
    if (teamMemberCount <= 1) {
        showToast('ต้องมีสมาชิกอย่างน้อย 1 คน', 'warning');
        return;
    }
    
    Swal.fire({
        title: 'ยืนยันการลบ?',
        text: `คุณต้องการลบสมาชิกคนที่ ${memberId} หรือไม่?`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#e74c3c',
        cancelButtonColor: '#95a5a6',
        confirmButtonText: 'ลบ',
        cancelButtonText: 'ยกเลิก'
    }).then((result) => {
        if (result.isConfirmed) {
            const memberDiv = document.getElementById(`team-member-${memberId}`);
            if (memberDiv) {
                memberDiv.remove();
                
                // Renumber remaining members
                renumberTeamMembers();
                
                showToast('ลบสมาชิกแล้ว', 'success');
            }
        }
    });
}

function renumberTeamMembers() {
    const members = document.querySelectorAll('.team-member-item');
    let newCount = 0;
    
    members.forEach((member, index) => {
        newCount++;
        member.id = `team-member-${newCount}`;
        
        const numberSpan = member.querySelector('.member-number');
        if (numberSpan) {
            numberSpan.innerHTML = `<i class="fas fa-user-circle"></i> สมาชิกคนที่ ${newCount}`;
        }
        
        // Update data attributes
        const inputs = member.querySelectorAll('[data-member]');
        inputs.forEach(input => {
            input.setAttribute('data-member', newCount);
        });
        
        // Update remove button
        const removeBtn = member.querySelector('.remove-member-btn');
        if (removeBtn) {
            removeBtn.setAttribute('onclick', `removeTeamMember(${newCount})`);
        }
    });
    
    teamMemberCount = newCount;
}

function getTeamMembersData() {
    const members = [];
    const memberDivs = document.querySelectorAll('.team-member-item');
    
    memberDivs.forEach((div, index) => {
        const memberId = index + 1;
        const name = div.querySelector(`.team-member-name[data-member="${memberId}"]`)?.value || '';
        const studentId = div.querySelector(`.team-member-id[data-member="${memberId}"]`)?.value || '';
        const grade = div.querySelector(`.team-member-grade[data-member="${memberId}"]`)?.value || '';
        
        if (name.trim()) {
            members.push({
                number: memberId,
                name: name.trim(),
                studentId: studentId.trim(),
                grade: grade.trim()
            });
        }
    });
    
    return members;
}

// ====================================
// Connection Status Management
// ====================================

function updateConnectionStatus(status) {
    const statusElement = document.getElementById('connectionStatus');
    statusElement.className = `connection-status ${status}`;
    
    switch(status) {
        case 'online':
            statusElement.innerHTML = '<i class="fas fa-wifi"></i> เชื่อมต่อแล้ว';
            break;
        case 'offline':
            statusElement.innerHTML = '<i class="fas fa-wifi"></i> ออฟไลน์';
            break;
        case 'loading':
            statusElement.innerHTML = '<i class="fas fa-sync fa-spin"></i> กำลังโหลด...';
            break;
        case 'error':
            statusElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ข้อผิดพลาด';
            break;
    }
}

// ====================================
// Toast Message System
// ====================================

function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast-message ${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 100);
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => document.body.removeChild(toast), 300);
    }, 4000);
}

// ====================================
// Show Section - Tab Navigation
// ====================================

function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(section => {
        section.classList.add('hidden');
    });

    const selectedSection = document.getElementById(sectionId);
    if (selectedSection) {
        selectedSection.classList.remove('hidden');
    }

    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });

    const activeBtn = document.getElementById('nav-' + sectionId);
    if (activeBtn) {
        activeBtn.classList.add('active');
    }

    window.scrollTo({ top: 0, behavior: 'smooth' });

    if (sectionId === 'dashboard') {
        loadDashboardData();
    } else if (sectionId === 'results') {
        loadResults();
    }
}

// ====================================
// Update category options based on competition type
// ====================================

document.getElementById('competitionType').addEventListener('change', function() {
    const competitionType = this.value;
    const categorySelect = document.getElementById('category');
    
    categorySelect.innerHTML = '<option value="">-- เลือกระดับชั้น/ประเภท --</option>';
    
    if (competitionType && competitionCategories[competitionType]) {
        competitionCategories[competitionType].forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
        });
    }
});

// ====================================
// File upload handler
// ====================================

function handleFileSelect(event) {
    const file = event.target.files[0];
    const fileNameDiv = document.getElementById('fileName');
    
    if (file) {
        if (file.size > 5 * 1024 * 1024) {
            Swal.fire({
                icon: 'error',
                title: 'ไฟล์มีขนาดใหญ่เกินไป',
                text: 'กรุณาเลือกไฟล์ที่มีขนาดไม่เกิน 5MB',
                confirmButtonColor: '#e74c3c'
            });
            event.target.value = '';
            fileNameDiv.innerHTML = '';
            return;
        }

        fileNameDiv.innerHTML = `
            <i class="fas fa-check-circle" style="color: #27ae60;"></i> 
            ไฟล์ที่เลือก: ${file.name} 
            <small style="color: #27ae60;">(${(file.size / 1024 / 1024).toFixed(2)} MB)</small>
        `;
    } else {
        fileNameDiv.innerHTML = '';
    }
}

// ====================================
// Convert file to base64
// ====================================

function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
    });
}

// ====================================
// Registration form submission
// ====================================

document.getElementById('registrationForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    if (isSubmitting) {
        showToast('กำลังบันทึกข้อมูล กรุณารอสักครู่...', 'warning');
        return;
    }

    const registrationType = document.getElementById('registrationType').value;
    
    // Validate based on registration type
    if (registrationType === 'team') {
        const teamMembers = getTeamMembersData();
        
        if (teamMembers.length === 0) {
            Swal.fire({
                icon: 'warning',
                title: 'กรุณาเพิ่มสมาชิกในทีม',
                text: 'ต้องมีสมาชิกในทีมอย่างน้อย 1 คน',
                confirmButtonColor: '#f39c12'
            });
            return;
        }

        if (!document.getElementById('teamName').value.trim()) {
            Swal.fire({
                icon: 'warning',
                title: 'กรุณากรอกชื่อทีม',
                confirmButtonColor: '#f39c12'
            });
            return;
        }
    } else {
        if (!document.getElementById('fullName').value.trim()) {
            Swal.fire({
                icon: 'warning',
                title: 'กรุณากรอกชื่อ-นามสกุล',
                confirmButtonColor: '#f39c12'
            });
            return;
        }
    }

    isSubmitting = true;
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> กำลังบันทึก...';

    Swal.fire({
        title: 'กำลังบันทึกข้อมูล...',
        html: 'โปรดรอสักครู่',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });

    try {
        const fileInput = document.getElementById('fileUpload');
        let fileData = null;
        let fileName = '';
        let mimeType = '';

        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            fileName = file.name;
            mimeType = file.type;
            fileData = await fileToBase64(file);
        }

        let formData;
        
        if (registrationType === 'team') {
            const teamMembers = getTeamMembersData();
            
            formData = new URLSearchParams({
                action: 'submitRegistration',
                registrationType: 'team',
                teamName: document.getElementById('teamName').value.trim(),
                school: document.getElementById('teamSchool').value.trim(),
                teamMembers: JSON.stringify(teamMembers),
                memberCount: teamMembers.length,
                competitionType: document.getElementById('competitionType').value,
                category: document.getElementById('category').value,
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim(),
                teacher: document.getElementById('teacher').value.trim(),
                fileData: fileData || '',
                fileName: fileName,
                mimeType: mimeType
            });
        } else {
            formData = new URLSearchParams({
                action: 'submitRegistration',
                registrationType: 'individual',
                fullName: document.getElementById('fullName').value.trim(),
                school: document.getElementById('school').value.trim(),
                competitionType: document.getElementById('competitionType').value,
                category: document.getElementById('category').value,
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim(),
                teacher: document.getElementById('teacher').value.trim(),
                fileData: fileData || '',
                fileName: fileName,
                mimeType: mimeType
            });
        }

        const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (!result.success) {
            throw new Error(result.error || 'การบันทึกข้อมูลไม่สำเร็จ');
        }

        if (result.isDuplicate) {
            Swal.fire({
                icon: 'info',
                title: 'ข้อมูลถูกบันทึกแล้ว',
                text: 'ข้อมูลของคุณได้ถูกบันทึกในระบบเรียบร้อยแล้ว',
                confirmButtonColor: '#667eea'
            });
        } else {
            let displayText = '';
            
            if (registrationType === 'team') {
                const teamMembers = getTeamMembersData();
                const membersList = teamMembers.map((m, i) => `${i + 1}. ${m.name}`).join('<br>');
                
                displayText = `
                    <p><strong>ชื่อทีม:</strong> ${document.getElementById('teamName').value}</p>
                    <p><strong>จำนวนสมาชิก:</strong> ${teamMembers.length} คน</p>
                    <div style="text-align: left; margin: 1rem 0; padding: 1rem; background: rgba(0,210,255,0.1); border-radius: 10px;">
                        <strong>รายชื่อสมาชิก:</strong><br>
                        ${membersList}
                    </div>
                    <p><strong>ประเภทการแข่งขัน:</strong> ${document.getElementById('competitionType').value}</p>
                    <p><strong>ระดับ/ประเภท:</strong> ${document.getElementById('category').value}</p>
                `;
            } else {
                displayText = `
                    <p><strong>ชื่อ:</strong> ${document.getElementById('fullName').value}</p>
                    <p><strong>ประเภทการแข่งขัน:</strong> ${document.getElementById('competitionType').value}</p>
                    <p><strong>ระดับ/ประเภท:</strong> ${document.getElementById('category').value}</p>
                `;
            }
            
            if (result.registrationNumber) {
                displayText += `<p><strong>หมายเลขลงทะเบียน:</strong> ${result.registrationNumber}</p>`;
            }
            
            Swal.fire({
                icon: 'success',
                title: 'ลงทะเบียนสำเร็จ!',
                html: `<p>ข้อมูลของคุณถูกบันทึกเรียบร้อยแล้ว</p>${displayText}`,
                confirmButtonText: 'ตกลง',
                confirmButtonColor: '#00d2ff'
            });

            showToast('ลงทะเบียนสำเร็จ!', 'success');
        }

        // Reset form
        document.getElementById('registrationForm').reset();
        document.getElementById('fileName').innerHTML = '';
        document.getElementById('category').innerHTML = '<option value="">-- เลือกระดับชั้น/ประเภท --</option>';
        
        // Clear team members
        document.getElementById('teamMembersList').innerHTML = '';
        teamMemberCount = 0;
        
        // Reset to individual
        setRegistrationType('individual');

        setTimeout(() => {
            loadDashboardData();
            loadResults();
        }, 2000);

    } catch (error) {
        console.error('Error:', error);
        Swal.fire({
            icon: 'error',
            title: 'เกิดข้อผิดพลาด',
            text: error.message || 'ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง',
            confirmButtonColor: '#e74c3c'
        });
        
        showToast('เกิดข้อผิดพลาดในการลงทะเบียน', 'error');
    } finally {
        setTimeout(() => {
            isSubmitting = false;
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> ส่งใบสมัครเข้าร่วมการแข่งขัน';
        }, 3000);
    }
});

// ====================================
// Initialize on page load
// ====================================

window.addEventListener('load', () => {
    updateConnectionStatus('loading');
    
    // Initialize first registration type
    setRegistrationType('individual');
    
    window.addEventListener('online', () => {
        updateConnectionStatus('online');
        showToast('เชื่อมต่ออินเทอร์เน็ตแล้ว', 'success');
    });
    
    window.addEventListener('offline', () => {
        updateConnectionStatus('offline');
        showToast('ไม่มีการเชื่อมต่ออินเทอร์เน็ต', 'error');
    });

    if (navigator.onLine) {
        updateConnectionStatus('online');
    } else {
        updateConnectionStatus('offline');
    }
});
    </script>
</body>
</html>
